// cSpell:words autoincrement kadiv sakit izin presences logbooks internships
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model users {
  id          String        @id @default(uuid()) @db.Char(36)
  full_name   String        @db.VarChar(100)
  email       String        @unique @db.VarChar(100)
  role        UserRole
  position    String        @db.VarChar(50)
  created_at  DateTime      @default(now())
  password    String        @db.VarChar(255)
  updated_at  DateTime      @updatedAt
  internship  internships?
  logbooks    logbooks[]
  permissions permissions[]
  presences   presences[]
}

model internships {
  id         BigInt           @id @default(autoincrement())
  user_id    String           @unique @db.Char(36)
  start_date DateTime         @db.Date
  end_date   DateTime         @db.Date
  status     InternshipStatus
  user       users            @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

model permissions {
  id              BigInt           @id @default(autoincrement())
  user_id         String           @db.Char(36)
  type            PermissionType
  title           String           @db.VarChar(255)
  reason          String           @db.Text
  start_date      DateTime         @db.Date
  end_date        DateTime         @db.Date
  attachment_path String?          @db.VarChar(255)
  status          PermissionStatus @default(sent)
  user            users            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  presences       presences[]

  @@index([user_id])
}

model presences {
  id            BigInt         @id @default(autoincrement())
  user_id       String         @db.Char(36)
  permission_id BigInt?
  date          DateTime       @db.Date
  check_in      DateTime?      @db.Time(0)
  check_out     DateTime?      @db.Time(0)
  location      String         @db.VarChar(255)
  image_url     String         @db.VarChar(255)
  status        PresenceStatus
  permission    permissions?   @relation(fields: [permission_id], references: [id])
  user          users          @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@index([permission_id])
}

model logbooks {
  id              BigInt        @id @default(autoincrement())
  user_id         String        @db.Char(36)
  date            DateTime      @db.Date
  title           String        @db.VarChar(255)
  activity_detail String        @db.Text
  result_output   String        @db.Text
  status          LogbookStatus @default(draft)
  user            users         @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
}

enum UserRole {
  intern
  mentor
  SDM
  kadiv
}

enum InternshipStatus {
  active
  completed
}

enum PermissionType {
  sakit
  izin
}

enum PermissionStatus {
  sent
  review_mentor
  review_kadiv
  approved
  rejected
}

enum PresenceStatus {
  present
  permission
  sick
  alpha
}

enum LogbookStatus {
  draft
  sent
  review_mentor
  review_kadiv
  approved
  rejected
}
